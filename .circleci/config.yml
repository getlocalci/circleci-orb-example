version: 2.1

orbs:
  node: circleci/node@5.0.0

jobs:
  php-lint:
    docker:
      - image: cimg/php:8.1
    steps:
      - checkout
      - run:
          name: Linting PHP
          command: |
            composer i
            composer lint

  php-test:
    parameters:
      php-version:
        type: string
    docker:
      - image: cimg/php:<< parameters.php-version >>
    steps:
      - checkout
      - run:
          name: Testing PHP
          command: |
            composer i
            composer test

workflows:
  test-lint:
    jobs:
      - node/run:
          npm-run: lint:js
      - node/test:
          requires:
            - node/run
          matrix:
            parameters:
              version: [ '14.18', '15.0', '16.14', '17.4' ]
          run-command: test:js
      - php-lint
      - php-test:
          requires:
            - php-lint
          matrix:
            parameters:
              php-version: [ '7.3', '7.4', '8.0', '8.1' ]
